namespace: swh

prometheus:
  address: http://thanos.internal.admin.swh.network:19191

sentry:
  enabled: true

tmpEphemeralStorage:
  claimTemplate:
    ephemeral:
      volumeClaimTemplate:
        metadata:
          labels:
            type: ephemeral-volume
        spec:
          accessModes: [ "ReadWriteOnce" ]
          storageClassName: "local-path"
          resources:
            requests:
              storage: 100Gi # no effects

memcached:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: "swh/memcached"
            operator: In
            values:
            - "true"

checkerDeposit:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: "swh/deposit"
            operator: In
            values:
            - "true"

storageReplayer:
  sentry:
    enabled: true
  cassandra:
    keySpace: swh
    consistencyLevel: LOCAL_QUORUM
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: node-role.kubernetes.io/etcd
            operator: NotIn
            values:
            - "true"

cookers:
  maxBundleSize: 1073741824
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: "swh/cooker"
            operator: In
            values:
            - "true"

loaderMetadata:
  dnsConfigurationRef: dnsConfiguration
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: "swh/loader-metadata"
            operator: In
            values:
            - "true"

indexers:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: "swh/indexer"
            operator: In
            values:
            - "true"

loaders:
  dnsConfigurationRef: dnsConfiguration
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: "swh/loader"
            operator: In
            values:
            - "true"

listers:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: "swh/lister"
            operator: In
            values:
            - "true"

graphql:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/rpc
            operator: In
            values:
            - "true"

storage:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/storage
            operator: In
            values:
            - "true"

scheduler:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/scheduler
            operator: In
            values:
            - "true"

vault:
  sentry:
    enabled: true
  extraConfig:
    smtp:
      host: smtp.inria.fr
      port: 25
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/rpc
            operator: In
            values:
            - "true"

web:
  migrations:
    enabled: true
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/web
            operator: In
            values:
            - "true"

deposit:
  migrations:
    enabled: true
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/deposit
            operator: In
            values:
            - "true"
  ingress:
    extraAnnotations:
      nginx.ingress.kubernetes.io/proxy-body-size: 4G
      nginx.ingress.kubernetes.io/proxy-buffering: "on"
      nginx.ingress.kubernetes.io/client-body-buffer-size: 128K
      nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"

indexerStorage:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/rpc
            operator: In
            values:
            - "true"

search:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/rpc
            operator: In
            values:
            - "true"
  journalClients:
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: swh/journal_client
              operator: In
              values:
              - "true"

scrubber:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: "swh/scrubber"
            operator: In
            values:
            - "true"

toolbox:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: "swh/toolbox"
            operator: In
            values:
            - "true"

objstorage:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/objstorage
            operator: In
            values:
            - "true"

webhooks:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/webhooks
            operator: In
            values:
            - "true"

statsd_exporter:
  enabled: true

counters:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/counters
            operator: In
            values:
            - "true"
  rpc:
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: swh/rpc
              operator: In
              values:
              - "true"
  journalClient:
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: swh/journal_client
              operator: In
              values:
              - "true"

objstorageReplayer:
  sentry:
    enabled: true
    secretKeyRef: common-secrets
    secretKeyName: objstorage-replayer-sentry-dsn
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: "swh/replayer"
            operator: In
            values:
            - "true"

dnsConfiguration:
  ndots: 1
  overrideSearch: true
#  extraSearch:
#    - internal.softwareheritage.org
#  nameservers: [ 10.43.0.10 ]
#  policy: None

cassandraChecks:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: swh/journal_client
            operator: In
            values:
            - "true"

storage_backfiller:
  sentry:
    enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: "swh/backfiller"
            operator: In
            values:
            - "true"

alter:
  sentry:
    enabled: true
    # secretKeyRef: common-secrets
    # secretKeyName: alter-sentry-dsn
  deployment:
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: "swh/alter"
              operator: In
              values:
              - "true"

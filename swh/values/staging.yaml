sentry:
  environment: staging

loaders:
  enabled: true
  storage:
    host: storage1.internal.staging.swh.network
    port: 5002
  amqp:
    host: scheduler0.internal.staging.swh.network
    port: 5672
  deployments:
    archive:
      requestedMemory: 256Mi
      requestedCpu: 200m
      image: swh_loader_package_image
      queues:
        - swh.loader.package.archive.tasks.LoadArchive
      autoScaling:
        maxReplicaCount: 1
      sentrySwhPackage: swh.loader.core
    addforgenow:
      image: swh_loader_git_image
      requestedMemory: 256Mi
      requestedCpu: 200m
      queues:
        - add_forge_now:swh.loader.git.tasks.UpdateGitRepository
      ackLate: true
      autoScaling:
        queueThreshold: 1
        maxReplicaCount: 5
      sentrySwhPackage: swh.loader.git
    bzr:
      requestedMemory: 256Mi
      requestedCpu: 200m
      queues:
        - swh.loader.bzr.tasks.LoadBazaar
      autoScaling:
        maxReplicaCount: 2
      sentrySwhPackage: swh.loader.bzr
    cran:
      requestedMemory: 256Mi
      requestedCpu: 200m
      image: swh_loader_package_image
      queues:
        - swh.loader.package.cran.tasks.LoadCRAN
      autoScaling:
        maxReplicaCount: 1
      sentrySwhPackage: swh.loader.core
    cvs:
      requestedMemory: 256Mi
      requestedCpu: 200m
      queues:
        - swh.loader.cvs.tasks.LoadCvsRepository
      autoScaling:
        maxReplicaCount: 3
      sentrySwhPackage: swh.loader.cvs
    debian:
      requestedMemory: 256Mi
      requestedCpu: 200m
      image: swh_loader_package_image
      queues:
        - swh.loader.package.debian.tasks.LoadDebian
      autoScaling:
        maxReplicaCount: 1
      sentrySwhPackage: swh.loader.core
    deposit:
      requestedMemory: 256Mi
      requestedCpu: 200m
      image: swh_loader_package_image
      queues:
        - swh.loader.package.deposit.tasks.LoadDeposit
      autoScaling:
        queueThreshold: 1
        maxReplicaCount: 3
      sentrySwhPackage: swh.loader.core
      extraConfig:
        deposit:
          url: "https://deposit-rp.internal.staging.swh.network/1/private"
          auth:
            username: "${DEPOSIT_USERNAME}"
            password: "${DEPOSIT_PASSWORD}"
        default_filename: archive.tar

    mercurial:
      requestedMemory: 256Mi
      requestedCpu: 200m
      queues:
        - swh.loader.mercurial.tasks.LoadArchiveMercurial
        - swh.loader.mercurial.tasks.LoadMercurial
      autoScaling:
        maxReplicaCount: 2
      sentrySwhPackage: swh.loader.mercurial
    nixguix:
      requestedMemory: 256Mi
      requestedCpu: 200m
      image: swh_loader_package_image
      queues:
        - swh.loader.package.nixguix.tasks.LoadNixguix
      autoScaling:
        queueThreshold: 1
        maxReplicaCount: 1
      sentrySwhPackage: swh.loader.core
      extraConfig:
        unsupported_file_extensions:
          - patch
          - iso
          - whl
          - gem
          - pom
          - msi
          - pod
          - png
          - rock
          - ttf
          - jar
          - c
          - el
          - rpm
          - diff
    highpriority:
      requestedMemory: 256Mi
      requestedCpu: 200m
      queues:
        - save_code_now:swh.loader.bzr.tasks.LoadBazaar
        - save_code_now:swh.loader.git.tasks.UpdateGitRepository
        - save_code_now:swh.loader.git.tasks.LoadDiskGitRepository
        - save_code_now:swh.loader.git.tasks.UncompressAndLoadDiskGitRepository
        - save_code_now:swh.loader.mercurial.tasks.LoadArchiveMercurial
        - save_code_now:swh.loader.mercurial.tasks.LoadMercurial
        - save_code_now:swh.loader.svn.tasks.LoadSvnRepository
        - save_code_now:swh.loader.svn.tasks.MountAndLoadSvnRepository
        - save_code_now:swh.loader.svn.tasks.DumpMountAndLoadSvnRepository
        - save_code_now:swh.loader.package.archive.tasks.LoadArchive
      ackLate: true
      autoScaling:
        queueThreshold: 1
        maxReplicaCount: 3
      sentrySwhPackage: swh.loader.highpriority
    git:
      requestedMemory: 256Mi
      requestedCpu: 200m
      queues:
        - swh.loader.git.tasks.UpdateGitRepository
        - swh.loader.git.tasks.LoadDiskGitRepository
        - swh.loader.git.tasks.UncompressAndLoadDiskGitRepository
      autoScaling:
        maxReplicaCount: 3
      sentrySwhPackage: swh.loader.git
    maven:
      requestedMemory: 256Mi
      requestedCpu: 200m
      image: swh_loader_package_image
      queues:
        - swh.loader.package.maven.tasks.LoadMaven
      autoScaling:
        maxReplicaCount: 2
      sentrySwhPackage: swh.loader.core
    npm:
      requestedMemory: 256Mi
      requestedCpu: 200m
      image: swh_loader_package_image
      queues:
        - swh.loader.package.npm.tasks.LoadNpm
      autoScaling:
        maxReplicaCount: 2
      sentrySwhPackage: swh.loader.core
    opam:
      requestedMemory: 256Mi
      requestedCpu: 200m
      image: swh_loader_package_image
      queues:
        - swh.loader.package.opam.tasks.LoadOpam
      autoScaling:
        maxReplicaCount: 1
      sentrySwhPackage: swh.loader.core
      extraConfig:
        # FIXME: Find a way to avoid this initialization step in loader task
        initialize_opam_root: true
    pypi:
      requestedMemory: 256Mi
      requestedCpu: 200m
      image: swh_loader_package_image
      queues:
        - swh.loader.package.pypi.tasks.LoadPyPI
      autoScaling:
        maxReplicaCount: 2
      sentrySwhPackage: swh.loader.core
    pubdev:
      requestedMemory: 256Mi
      requestedCpu: 200m
      image: swh_loader_package_image
      queues:
        - swh.loader.package.pubdev.tasks.LoadPubDev
      autoScaling:
        maxReplicaCount: 2
      sentrySwhPackage: swh.loader.core
    svn:
      requestedMemory: 256Mi
      requestedCpu: 200m
      queues:
        - swh.loader.svn.tasks.LoadSvnRepository
        - swh.loader.svn.tasks.MountAndLoadSvnRepository
        - swh.loader.svn.tasks.DumpMountAndLoadSvnRepository
      autoScaling:
        maxReplicaCount: 2
      sentrySwhPackage: swh.loader.svn

listers:
  enabled: true
  sentrySwhPackage: swh.lister
  storage:
    host: storage1.internal.staging.swh.network
    port: 5002
  scheduler:
    host: scheduler0.internal.staging.swh.network
    port: 5008
  amqp:
     host: scheduler0.internal.staging.swh.network
  deployments:
    gnu-full:
      queues:
        - swh.lister.gnu.tasks.GNUListerTask
      autoScaling:
        maxReplicaCount: 1
    pubdev:
      logLevel: DEBUG
      queues:
        - swh.lister.pubdev.tasks.PubDevListerTask
      autoScaling:
        maxReplicaCount: 1
    gogs-full:
      queues:
        - swh.lister.gogs.tasks.FullGogsRelister
      autoScaling:
        maxReplicaCount: 1
    maven:
      queues:
      - swh.lister.maven.tasks.FullMavenLister
      - swh.lister.maven.tasks.IncrementalMavenLister
      autoScaling:
        maxReplicaCount: 1
    bitbucket:
      queues:
      - swh.lister.bitbucket.tasks.IncrementalBitBucketLister
      - swh.lister.bitbucket.tasks.FullBitBucketRelister
      autoScaling:
        maxReplicaCount: 1
    sourceforge:
      queues:
      - swh.lister.sourceforge.tasks.FullSourceForgeLister
      - swh.lister.sourceforge.tasks.IncrementalSourceForgeLister
      autoScaling:
        maxReplicaCount: 1
    opam:
      queues:
      - swh.lister.opam.tasks.OpamListerTask
      autoScaling:
        maxReplicaCount: 1
    launchpad:
      queues:
      - swh.lister.launchpad.tasks.FullLaunchpadLister
      - swh.lister.launchpad.tasks.IncrementalLaunchpadLister
      autoScaling:
        maxReplicaCount: 1
    all:
      maxTasksperchild: 3
      queues:
      - swh.lister.cgit.tasks.CGitListerTask
      - swh.lister.cran.tasks.CRANListerTask
      - swh.lister.debian.tasks.DebianListerTask
      - swh.lister.gitea.tasks.IncrementalGiteaLister
      - swh.lister.gitea.tasks.RangeGiteaLister
      - swh.lister.gitea.tasks.FullGiteaRelister
      - swh.lister.gitlab.tasks.IncrementalGitLabLister
      - swh.lister.gitlab.tasks.RangeGitLabLister
      - swh.lister.gitlab.tasks.FullGitLabRelister
      - swh.lister.npm.tasks.NpmListerTask
      - swh.lister.phabricator.tasks.FullPhabricatorLister
      - swh.lister.pypi.tasks.PyPIListerTask
      autoScaling:
        maxReplicaCount: 2


graphql:
  enabled: true
  sentry_enabled: true
  backends:
    storage:
      host: webapp.internal.staging.swh.network
      port: 5002
    search:
      host: search0.internal.staging.swh.network
      port: 5010
  replicas: 1
  gunicorn:
    threads: 4
    workers: 2
    timeout: 3600
  ingress:
    enabled: true
    httpPath: /
    host: graphql.staging.swh.network
  logLevel: DEBUG


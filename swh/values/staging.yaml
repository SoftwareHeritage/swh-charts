sentry:
  environment: staging

loaders:
  enabled: true
  storage:
    host: storage1.internal.staging.swh.network
    port: 5002
  amqp:
    host: scheduler0.internal.staging.swh.network
  deployments:
    # bzr:
    #   requestedMemory: 256Mi
    #   requestedCpu: 200m
    #   queues:
    #     - swh.loader.bzr.tasks.LoadBazaar
    #   autoScaling:
    #     queueThreshold: 10
    #     maxReplicaCount: 3
    #   sentrySwhPackage: swh.loader.bzr
    # cvs:
    #   requestedMemory: 256Mi
    #   requestedCpu: 200m
    #   queues:
    #     - swh.loader.cvs.tasks.LoadCvsRepository
    #   autoScaling:
    #     queueThreshold: 10
    #     maxReplicaCount: 3
    #   sentrySwhPackage: swh.loader.cvs
    # hg:
    #   requestedMemory: 256Mi
    #   requestedCpu: 200m
    #   queues:
    #     - swh.loader.mercurial.tasks.LoadArchiveMercurial
    #     - swh.loader.mercurial.tasks.LoadMercurial
    #   autoScaling:
    #     queueThreshold: 10
    #     maxReplicaCount: 3
    #   sentrySwhPackage: swh.loader.mercurial
    highpriority:
      requestedMemory: 256Mi
      requestedCpu: 200m
      queues:
        - save_code_now:swh.loader.bzr.tasks.LoadBazaar
        - save_code_now:swh.loader.git.tasks.UpdateGitRepository
        - save_code_now:swh.loader.git.tasks.LoadDiskGitRepository
        - save_code_now:swh.loader.git.tasks.UncompressAndLoadDiskGitRepository
        - save_code_now:swh.loader.mercurial.tasks.LoadArchiveMercurial
        - save_code_now:swh.loader.mercurial.tasks.LoadMercurial
        - save_code_now:swh.loader.svn.tasks.LoadSvnRepository
        - save_code_now:swh.loader.svn.tasks.MountAndLoadSvnRepository
        - save_code_now:swh.loader.svn.tasks.DumpMountAndLoadSvnRepository
        - save_code_now:swh.loader.package.archive.tasks.LoadArchive
      autoScaling:
        queueThreshold: 10
        maxReplicaCount: 3
      sentrySwhPackage: swh.loader.highpriority
    git:
      requestedMemory: 256Mi
      requestedCpu: 200m
      queues:
        - swh.loader.git.tasks.UpdateGitRepository
        - swh.loader.git.tasks.LoadDiskGitRepository
        - swh.loader.git.tasks.UncompressAndLoadDiskGitRepository
      autoScaling:
        queueThreshold: 5  # spawn worker per increment of `value` messages
        maxReplicaCount: 3
      sentrySwhPackage: swh.loader.git
    # maven:
    #   requestedMemory: 256Mi
    #   requestedCpu: 200m
    #   queues:
    #     - swh.loader.package.maven.tasks.LoadMaven
    #   autoScaling:
    #     queueThreshold: 10
    #     maxReplicaCount: 3
    #   sentrySwhPackage: swh.loader.core
    # npm:
    #   requestedMemory: 256Mi
    #   requestedCpu: 200m
    #   queues:
    #     - swh.loader.package.npm.tasks.LoadNpm
    #   autoScaling:
    #     queueThreshold: 10
    #     maxReplicaCount: 3
    #   sentrySwhPackage: swh.loader.core
    pypi:
      requestedMemory: 256Mi
      requestedCpu: 200m
      queues:
        - swh.loader.package.pypi.tasks.LoadPyPI
      autoScaling:
        queueThreshold: 10
        maxReplicaCount: 1
      sentrySwhPackage: swh.loader.core
    # svn:
    #   requestedMemory: 256Mi
    #   requestedCpu: 200m
    #   queues:
    #     - swh.loader.svn.tasks.LoadSvnRepository
    #     - swh.loader.svn.tasks.MountAndLoadSvnRepository
    #     - swh.loader.svn.tasks.DumpMountAndLoadSvnRepository
    #   autoScaling:
    #     queueThreshold: 10
    #     maxReplicaCount: 3
    #   sentrySwhPackage: swh.loader.svn

listers:
  enabled: true
  sentrySwhPackage: swh.lister
  storage:
    host: storage1.internal.staging.swh.network
    port: 5002
  scheduler:
    host: scheduler0.internal.staging.swh.network
    port: 5008
  amqp:
     host: scheduler0.internal.staging.swh.network
  deployments:
    gnu-full:
      queues:
        - swh.lister.gnu.tasks.GNUListerTask
      autoScaling:
        queueThreshold: 10
        maxReplicaCount: 1

graphql:
  enabled: true
  sentry_enabled: true
  backends:
    storage:
      host: webapp.internal.staging.swh.network
      port: 5002
    search:
      host: search0.internal.staging.swh.network
      port: 5010
  replicas: 1
  gunicorn:
    threads: 4
    workers: 2
    timeout: 3600
  ingress:
    enabled: true
    httpPath: /
    host: graphql.staging.swh.network
  logLevel: DEBUG


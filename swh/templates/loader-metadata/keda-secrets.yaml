{{ if and .Values.loaderMetadata.enabled .Values.loaderMetadata.autoScaling.enabled -}}
{{- $journalUser := .Values.loaderMetadata.journalBrokers.user -}}
apiVersion: v1
kind: Secret
metadata:
  name: keda-loader-metadata-kafka-secrets
  namespace: {{ .Values.namespace }}
type: Opaque
stringData:
  sasl: "scram_sha512"
  username: {{ $journalUser }}
  tls: "enable"
---
apiVersion: keda.sh/v1alpha1
kind: TriggerAuthentication
metadata:
  name: keda-loader-metadata-trigger-authentication
  namespace: {{ .Values.namespace }}
spec:
  secretTargetRef:
  - parameter: sasl
    name: keda-loader-metadata-kafka-secrets
    key: sasl
  - parameter: username
    name: keda-loader-metadata-kafka-secrets
    key: username
  - parameter: tls
    name: keda-loader-metadata-kafka-secrets
    key: tls
  - parameter: password
    name: {{ .Values.loaderMetadata.journalBrokers.secretName }}
    key: BROKER_USER_PASSWORD
{{- end -}}

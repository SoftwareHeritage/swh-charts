{{ if .Values.storage.enabled -}}
---
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: {{ .Values.namespace }}
  name: storage-configuration-template
data:
  config.yml.template: |
    {{- include "swh.storageConfiguration" (dict "configurationRef" .Values.storage.storageConfigurationRef
                                                "Values" .Values ) | nindent 4 }}
      objstorage:
        cls: {{ .Values.storage.objstorageClass }}
      {{- if eq .Values.storage.objstorageClass "filtered" }}
        {{- toYaml .Values.storage.objstorageConfig | nindent 8 }}
      {{- else if eq .Values.storage.objstorageClass "multiplexer" }}
        objstorages:
        {{ .Values.storage.objstorageConfig }}
      {{- else }}
        {{ toYaml .Values.storage.objstorageConfig }}
      {{- end -}}
      {{- if .Values.storage.journalWriter }}
        {{- with .Values.storage.journalWriter }}
      journal_writer:
        cls: kafka
        brokers:
          {{- range $broker := .brokers }}
          - {{ $broker }}
          {{- end}}
        prefix: {{ .prefix | default "swh.journal.objects" }}
        client_id: {{ .clientId }}
        anonymize: {{ .anonymize | default true }}
        producer_config: {{ .producerConfig | nindent 10 }}
        {{- end }}
      {{- end }}
{{- end -}}

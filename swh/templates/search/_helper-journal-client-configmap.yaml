{{/*
   * Generate the configuration map for search journal client instance
   */}}
{{ define "swh.journal.client.configmap" }}
{{- $journalClientOverrides := get .journalClientConfig "journalClientOverrides" | default dict -}}
{{- $config := deepCopy .configuration | mergeOverwrite .journalClientConfig -}}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: search-journal-client-{{ .journalClientType }}-configuration-template
  namespace: {{ .Values.namespace }}
data:
  config.yml.template: |
    {{- include "swh.service.fromYaml" (dict "service" "search"
                                             "configurationRef" $config.searchConfigurationRef
                                             "Values" .Values) | nindent 4 }}
    {{- include "swh.service.fromYaml" (dict "service" "storage"
                                             "configurationRef" $config.storageConfigurationRef
                                             "Values" .Values) | nindent 4 }}
    {{- include "swh.journalClientConfiguration" (dict "configurationRef" $config.journalConfigurationRef
                                                       "overrides" $journalClientOverrides
                                                       "Values" .Values) | nindent 4 }}

{{ end }}

{{- $secretName := .Values.storage_replayer.journalBrokers.secretName -}}
{{ if and .Values.storage_replayer.enabled $secretName -}}
---
apiVersion: v1
kind: Secret
metadata:
  name: keda-storage-replayer-kafka-secrets
  namespace: {{ .Values.namespace }}
type: Opaque
stringData:
  sasl: "scram_sha512"
  username: {{ .Values.storage_replayer.journalBrokers.user }}
  tls: "enable"
---
apiVersion: keda.sh/v1alpha1
kind: TriggerAuthentication
metadata:
  name: keda-storage-replayer-trigger-authentication
  namespace: {{ .Values.namespace }}
spec:
  secretTargetRef:
  - parameter: sasl
    name: keda-storage-replayer-kafka-secrets
    key: sasl
  - parameter: username
    name: keda-storage-replayer-kafka-secrets
    key: username
  - parameter: tls
    name: keda-storage-replayer-kafka-secrets
    key: tls
  - parameter: password
    name: {{ $secretName }}
    key: BROKER_USER_PASSWORD
{{- end -}}

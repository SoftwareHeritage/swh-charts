{{ if .Values.storageReplayer.enabled -}}
{{- $secretName := .Values.storageReplayer.journalBrokers.secretName -}}
{{- $secrets := .Values.storageReplayer.journalBrokers.secrets -}}
{{ if and .Values.storageReplayer.enabled (or $secretName $secrets) -}}
---
apiVersion: v1
kind: Secret
metadata:
  name: keda-storage-replayer-kafka-secrets
  namespace: {{ .Values.namespace }}
type: Opaque
stringData:
  sasl: "scram_sha512"
  username: {{ .Values.storageReplayer.journalBrokers.user }}
  tls: "enable"
---
apiVersion: keda.sh/v1alpha1
kind: TriggerAuthentication
metadata:
  name: keda-storage-replayer-trigger-authentication
  namespace: {{ .Values.namespace }}
spec:
  secretTargetRef:
  - parameter: sasl
    name: keda-storage-replayer-kafka-secrets
    key: sasl
  - parameter: username
    name: keda-storage-replayer-kafka-secrets
    key: username
  - parameter: tls
    name: keda-storage-replayer-kafka-secrets
    key: tls
  {{- if $secretName }}
  - parameter: password
    name: {{ $secretName }}
    key: BROKER_USER_PASSWORD
  {{ end }}
  {{- if $secrets }}
  - parameter: password
    name: {{ $secrets.BROKER_USER_PASSWORD.secretKeyRef }}
    key: {{ $secrets.BROKER_USER_PASSWORD.secretKeyName }}
  {{ end }}
{{- end -}}
{{ end }}

{{ if and .Values.counters.enabled .Values.counters.rpc.enabled  -}}
{{- with .Values.counters.rpc }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: {{ $.Values.namespace }}
  name: counters-rpc-configuration-template
data:
  config.yml.template: |
    {{- include "swh.service.fromYaml"
      (dict "service" "counters"
            "configurationRef" .countersConfigurationRef
            "Values" $.Values) | nindent 4 }}

    {{- include "swh.service.fromYaml"
      (dict "service" "history"
            "configurationRef" .historyConfigurationRef
            "Values" $.Values) | nindent 4 }}
      cache_base_directory: {{ .cacheBaseDirectory }}

{{- end -}}
{{- end -}}

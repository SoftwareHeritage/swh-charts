{{ if .Values.toolbox.enabled -}}
{{- $namespace := .Values.namespace -}}
{{- range $service_type, $deployment_config := .Values.toolbox.configs }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: toolbox-{{ $service_type }}-template
  namespace: {{ $namespace }}
data:
  config.yml.template: |
    {{- if ( eq "scheduler" $service_type ) }}
{{ include "swh.postgresql" (dict "serviceType" "scheduler"
                                  "Values" $.Values
                                  "configurationRef" $deployment_config.schedulerConfigurationRef) | indent 4 }}
{{ include "celery.configuration" (list $.Values $deployment_config.celeryConfigurationRef) | indent 4 }}
    {{- else if ( eq "storage" $service_type ) }}
{{ include "swh.postgresql" (dict "serviceType" "storage"
                                   "Values" $.Values
                                   "configurationRef" $deployment_config.storageConfigurationRef) | indent 4 }}
    {{- else if ( eq "scrubber" $service_type ) }}
{{ include "swh.postgresql" (dict "serviceType" "scrubber"
                                  "Values" $.Values
                                  "configurationRef" $deployment_config.scrubberConfigurationRef) | indent 4 }}
    {{- else }}
    {{ fail (print "toolbox.configmap: Configuration <" $service_type "> unsupported.") }}
    {{- end -}}

{{ end }}
{{- end -}}

{{ if .Values.toolbox.enabled -}}
{{- $namespace := .Values.namespace -}}
{{- range $service_type, $deployment_config := .Values.toolbox.configs }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: toolbox-{{ $service_type }}-template
  namespace: {{ $namespace }}
data:
  config.yml.template: |
{{ include "swh.postgresql" (dict "serviceType" $service_type
                                  "Values" $.Values
                                  "configurationRef" (get $deployment_config (print $service_type "ConfigurationRef"))) | indent 4 }}
    {{- if ( eq "scheduler" $service_type ) }}
{{ include "celery.configuration" (list $.Values $deployment_config.celeryConfigurationRef) | indent 4 }}
    {{ end }}
{{ end }}
{{- end -}}

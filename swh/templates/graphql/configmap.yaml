{{ if .Values.graphql.enabled -}}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: graphql
  namespace: {{ .Values.namespace }}
data:
  # TODO: rename to not have a dot in the name to allow testing
  config.yml: |
    {{- range $backend, $backend_config := .Values.graphql.backends }}
    {{ $backend }}:
      cls: remote
      url: http://{{ get $backend_config "host" }}:{{ get $backend_config "port" }}
    {{- end }}

    debug: {{ .Values.graphql.debug }}

    introspection: {{ .Values.graphql.introspection }}

    max_query_cost:
      anonymous: {{ .Values.graphql.maxQueryCost}}
{{ end }}

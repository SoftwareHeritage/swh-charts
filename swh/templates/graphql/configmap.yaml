{{ if .Values.graphql.enabled -}}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: graphql
  namespace: {{ .Values.namespace }}
data:
  # TODO: rename to not have a dot in the name to allow testing
  config.yml: |
    {{- range $backend, $backend_config := .Values.graphql.backends }}
    {{ $backend }}:
      cls: remote
      url: http://{{ get $backend_config "host" }}:{{ get $backend_config "port" }}
    {{- end }}

    debug: {{ .Values.graphql.debug }}

    introspection: {{ .Values.graphql.introspection }}

    max_query_cost:
      anonymous: {{ .Values.graphql.maxQueryCost}}

    {{ if .Values.graphql.auth -}}
    auth:
      server: {{ .Values.graphql.auth.server | default "" }}
      realm: {{ .Values.graphql.auth.realm | default "" }}
      client: {{ .Values.graphql.auth.client | default "swh-web" }}
      cache:
        url: {{ .Values.graphql.auth.cacheUrl | default "memory://" }}
    {{- end }}
{{ end }}

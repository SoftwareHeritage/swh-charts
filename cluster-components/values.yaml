---
# Main common configuration for the chart.

# All applications whose 'enabled' flag is false by default are applications that are
# already installed in the cluster by the main swh provisioning except for the clusters
# minikube (local dev) and rancher (admin cluster).
cert-manager:
  enabled: false

# This configuration is swh specific (and independent from the prometheus configuration
# already done during terraform provisioning). When activated, this allows to relay the
# cluster's prometheus alerts to the cluster admin's alertmanager ingress irc relay
alertmanager:
  enabled: false
  ircrelay:
    enabled: true
    host: https://alertmanager-irc-relay.internal.admin.swh.network/swh-sysadm
    # .htaccess or authentication credentials
    # secret:

prometheus:
  enabled: false
  namespaceOverride: cattle-monitoring-system
  grafana:
    namespaceOverride: cattle-monitoring-system
  prometheus-node-exporter:
    namespaceOverride: cattle-monitoring-system
  kube-state-metrics:
    namespaceOverride: cattle-monitoring-system

alertmanagerConfig:
  enabled: true
  host: https://alertmanager-irc-relay.admin.swh.network/swh-sysadm

alertmanagerIrcRelay:
  enabled: false
  ingress:
    enabled: true
    hosts:
      - alertmanager-irc-relay.admin.swh.network
      - alertmanager-irc-relay.internal.admin.swh.network
    # secret holding the .htpasswd information
    authentication: ingress-nginx/basic-auth
    tls:
      enabled: true
      # clusterIssuer: letsencrypt-production
  http_port: 8000
  # Room to connect to
  room: swh-sysadm
  # requestedMemory: "128Mi"
  # requestedCpu: "500"
  # optional
  # limitedMemory: "256Mi"
  # limitedCpu: "1000"

blackboxExporter:
  enabled: false
  nameOverride: blackbox-exporter
  namespaceOverride: cattle-monitoring-system
  serviceMonitor:
    enabled: true
    selfMonitor:
      enabled: true
    prometheusRule:
      enabled: true
  pspEnabled: false
  config:
    modules:
      swh_www:
        prober: http
        timeout: 5s
        http:
          valid_http_versions: ["HTTP/1.1", "HTTP/2.0"]
          follow_redirects: true
          preferred_ip_protocol: "ip4"
          fail_if_body_not_matches_regexp:
            - '<title>Software Heritage</title>'

podPriority:
  enabled: false
  priorities:
    system:
      # informational value (not used yet?)
      range: 50000-100000
      value: 75000
      description: Highest pod priorities (ingress, operator, collector, controller
    storages:
      range: 25000-26000
      value: 25500
      description: Backend storages used by other services (memcached, redis, ...)
    frontend-rpc:
      range: 23000-24000
      value: 24500
      description: Frontend or RPC services (swh-web, swh-graphql, swh-storage, ...)
    frontend-rpc-workload:
      range: 22000-23000
      value: 22500
      description: Frontend or RPC services workload (checker-deposit, swh-search-journalclient, ...)
    high-workload:
      range: 20000-21000
      value: 20500
      description: High priority workload (save-code-now, add-forge-now, graph computations, ...)
    local-workload:
      range: 10000-15000
      value: 12500
    normal-workload:
      range: 7000-8000
      value: 6500
      description: Normal workload (vault cooker workers, listers, most loaders, ...)
    low-workload:
      range: 5000-6000
      value: 5500
      description: Normal workload (vault cooker workers, listers, most loaders, ...)
    background-storage:
      range: 3000-4000
      value: 3500
      description: Background storage maintenance (reaper, scrubber, ...)
    background-workload:
      range: 1000-2000
      value: 1500
      description: Background workload (replayers cassandra & postgres, redis error reporter, ...)
    tools:
      range: 0-100
      value: 50
      description: Tooling helper (swh-toolbox)


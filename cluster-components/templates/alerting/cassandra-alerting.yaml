{{ if .Values.alerting.enabled -}}
{{ with .Values.alerting.cassandra -}}
---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    app: cassandra
  name: critical-cassandra-service.rules
  namespace: cattle-monitoring-system
spec:
  groups:
  - name: critical-cassandra-service.rules
    rules:
    - alert: Cassandra_Service_Degraded_In_{{ .environment | title }}
      annotations:
        description: "The {{"{{"}} $labels.instance {{"}}"}} node is unreachable for more than 5 minutes. This node seems down."
        summary: "The {{"{{"}} $labels.service {{"}}"}} is degraded. Please check the {{"{{"}} $labels.instance {{"}}"}} status."
      expr: up{service="cassandra-servers-svc"} == 0
      for: {{ .period }}
      labels:
        severity: critical
        namespace: cattle-monitoring-system
{{- end }}
{{- end }}

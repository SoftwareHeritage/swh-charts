{{- if .Values.redis.enabled -}}
{{- range $deploymentName, $deploymentConfig := .Values.redis.deployments -}}
{{- if or (not (hasKey $deploymentConfig "enabled")) (get $deploymentConfig "enabled") -}}
{{- $labels := $deploymentConfig.labels | default $.Values.redis.labels -}}
{{- $extraConfig := $deploymentConfig.extraConfig | default $.Values.redis.extraConfig -}}
{{- if (or (not (hasKey $extraConfig "enabled")) (get $extraConfig "enabled")) -}}
{{- $ns := $deploymentConfig.namespace | default $.Values.redis.namespace -}}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: redis-{{ $deploymentName }}-ext-config
  namespace: {{ $ns }}
  labels:
    app: redis-{{ $deploymentName }}
  {{- if $labels }}
    {{- toYaml $labels | nindent 4 }}
  {{- end }}
data:
  redis-additional.conf: |
    {{- $extraConfig.data | nindent 4 }}
{{ end }}
{{- end }}
{{- end }}
{{ end }}
